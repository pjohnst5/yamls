Bad dual stack ipv4 & ipv6 add command CNI
2023/01/17 16:32:00 [3256] [cni-net] Processing ADD command with args {ContainerID:26ab51014ce8c1420a8adc0d5496b8e76118ddf9484a04fc07339123a5f0f50f Netns:63258ae5-03f7-46ab-bf53-a577e4034f41 IfName:eth0 Args:IgnoreUnknown=1;K8S_POD_NAMESPACE=kube-system;K8S_POD_NAME=csi-azuredisk-node-win-gj7xl;K8S_POD_INFRA_CONTAINER_ID=26ab51014ce8c1420a8adc0d5496b8e76118ddf9484a04fc07339123a5f0f50f;K8S_POD_UID=4c95e140-2b02-4413-b255-2313b5551901 Path:c:/k/azurecni/bin StdinData:{"AdditionalArgs":[{"Name":"EndpointPolicy","Value":{"ExceptionList":["10.240.0.0/16","10.224.0.0/12"],"Type":"OutBoundNAT"}},{"Name":"EndpointPolicy","Value":{"Action":"Block","Direction":"Out","Priority":200,"Protocols":"6","RemoteAddresses":"168.63.129.16/32","RemotePorts":"80","RuleType":"Switch","Type":"ACL"}},{"Name":"EndpointPolicy","Value":{"Action":"Allow","Direction":"In","Priority":65500,"Type":"ACL"}},{"Name":"EndpointPolicy","Value":{"Action":"Allow","Direction":"Out","Priority":65500,"Type":"ACL"}}],"bridge":"azure0","capabilities":{"dns":true,"portMappings":true},"cniVersion":"0.3.0","dns":{"Nameservers":["10.0.0.10","168.63.129.16"],"Search":["svc.cluster.local"]},"executionMode":"v4swift","ipam":{"mode":"dualModeOverlay","type":"azure-cns"},"mode":"bridge","name":"azure","runtimeConfig":{"dns":{"Servers":["10.0.0.10"],"Searches":["kube-system.svc.cluster.local","svc.cluster.local","cluster.local"],"Options":["ndots:5"]}},"type":"azure-vnet","windowsSettings":{"enableLoopbackDSR":true}}}.
2023/01/17 16:32:00 [3256] csi-azuredisk-node-win-gj7xl
2023/01/17 16:32:00 [3256] Requesting IP for pod {PodName:csi-azuredisk-node-win-gj7xl PodNamespace:kube-system} using ipconfig [IPConfigRequest: DesiredIPAddress , PodInterfaceID 26ab5101-eth0, InfraContainerID 26ab51014ce8c1420a8adc0d5496b8e76118ddf9484a04fc07339123a5f0f50f, OrchestratorContext {"PodName":"csi-azuredisk-node-win-gj7xl","PodNamespace":"kube-system"}]
2023/01/17 16:32:01 [3256] [cni-invoker-cns] Received info {podIPAddress:10.240.2.67 ncSubnetPrefix:16 ncPrimaryIP:10.240.2.0 ncGatewayIPAddress: hostSubnet:10.224.0.0/16 hostPrimaryIP:10.224.0.4 hostGateway:10.224.0.1} for pod {csi-azuredisk-node-win-gj7xl kube-system}
2023/01/17 16:32:01 [3256] [cni-invoker-cns] Received info {podIPAddress:fd11:1234::12e ncSubnetPrefix:112 ncPrimaryIP:fd11:1234::100 ncGatewayIPAddress: hostSubnet:10.224.0.0/16 hostPrimaryIP:10.224.0.4 hostGateway:10.224.0.1} for pod {csi-azuredisk-node-win-gj7xl kube-system}
2023/01/17 16:32:01 [3256] [Ashvin] ipamAddResult
2023/01/17 16:32:01 [3256] [cni-net] Creating network azure.
2023/01/17 16:32:01 [3256] [cni-net] Found master interface vEthernet (Ethernet 2).
2023/01/17 16:32:01 [3256] Acquiring process lock
2023/01/17 16:32:01 [3256] Acquired process lock
2023/01/17 16:32:01 [3256] [net] Save succeeded.
2023/01/17 16:32:01 [3256] Released process lock
2023/01/17 16:32:01 [3256] [cni-net] nwDNSInfo: {kube-system.svc.cluster.local,svc.cluster.local,cluster.local [10.0.0.10] [ndots:5]}
2023/01/17 16:32:01 [3256] podSubnetV4Prefix is 10.240.0.0/16
2023/01/17 16:32:01 [3256] podSubnetV6Prefix is fd11:1234::/112
2023/01/17 16:32:01 [3256] nwInfo is {MasterIfName:vEthernet (Ethernet 2) AdapterName: Id:azure Mode:bridge Subnets:[{Family:2 Prefix:{IP:10.240.0.0 Mask:ffff0000} Gateway:169.254.1.1 PrimaryIP:<nil>} {Family:10 Prefix:{IP:fd11:1234:: Mask:ffffffffffffffffffffffffffff0000} Gateway:169.254.1.1 PrimaryIP:<nil>}] PodSubnet:{Family:0 Prefix:{IP:<nil> Mask:<nil>} Gateway:<nil> PrimaryIP:<nil>} DNS:{Suffix:kube-system.svc.cluster.local,svc.cluster.local,cluster.local Servers:[10.0.0.10] Options:[ndots:5]} Policies:[{Type:EndpointPolicy Data:[123 34 69 120 99 101 112 116 105 111 110 76 105 115 116 34 58 91 34 49 48 46 50 52 48 46 48 46 48 47 49 54 34 44 34 49 48 46 50 50 52 46 48 46 48 47 49 50 34 93 44 34 84 121 112 101 34 58 34 79 117 116 66 111 117 110 100 78 65 84 34 125]} {Type:EndpointPolicy Data:[123 34 65 99 116 105 111 110 34 58 34 66 108 111 99 107 34 44 34 68 105 114 101 99 116 105 111 110 34 58 34 79 117 116 34 44 34 80 114 105 111 114 105 116 121 34 58 50 48 48 44 34 80 114 111 116 111 99 111 108 115 34 58 34 54 34 44 34 82 101 109 111 116 101 65 100 100 114 101 115 115 101 115 34 58 34 49 54 56 46 54 51 46 49 50 57 46 49 54 47 51 50 34 44 34 82 101 109 111 116 101 80 111 114 116 115 34 58 34 56 48 34 44 34 82 117 108 101 84 121 112 101 34 58 34 83 119 105 116 99 104 34 44 34 84 121 112 101 34 58 34 65 67 76 34 125]} {Type:EndpointPolicy Data:[123 34 65 99 116 105 111 110 34 58 34 65 108 108 111 119 34 44 34 68 105 114 101 99 116 105 111 110 34 58 34 73 110 34 44 34 80 114 105 111 114 105 116 121 34 58 54 53 53 48 48 44 34 84 121 112 101 34 58 34 65 67 76 34 125]} {Type:EndpointPolicy Data:[123 34 65 99 116 105 111 110 34 58 34 65 108 108 111 119 34 44 34 68 105 114 101 99 116 105 111 110 34 58 34 79 117 116 34 44 34 80 114 105 111 114 105 116 121 34 58 54 53 53 48 48 44 34 84 121 112 101 34 58 34 65 67 76 34 125]}] BridgeName:azure0 EnableSnatOnHost:false NetNs:63258ae5-03f7-46ab-bf53-a577e4034f41 Options:map[NCPrimaryIPKey:fd11:1234::100] DisableHairpinOnHostInterface:false IPV6Mode: IPAMType:azure-cns ServiceCidrs:}
2023/01/17 16:32:01 [3256] Subnets is [{Family:2 Prefix:{IP:10.240.0.0 Mask:ffff0000} Gateway:169.254.1.1 PrimaryIP:<nil>} {Family:10 Prefix:{IP:fd11:1234:: Mask:ffffffffffffffffffffffffffff0000} Gateway:169.254.1.1 PrimaryIP:<nil>}]
2023/01/17 16:32:01 [3256] ipamAddResult is {ipv4Result:0xc000206630 ipv6Result:0xc0002066e0 ncResponse:<nil> hostSubnetPrefix:{IP:[10 224 0 0] Mask:[255 255 0 0]}}
2023/01/17 16:32:01 [3256] later nwInfo is {MasterIfName:vEthernet (Ethernet 2) AdapterName: Id:azure Mode:bridge Subnets:[{Family:2 Prefix:{IP:10.240.0.0 Mask:ffff0000} Gateway:169.254.1.1 PrimaryIP:<nil>} {Family:10 Prefix:{IP:fd11:1234:: Mask:ffffffffffffffffffffffffffff0000} Gateway:169.254.1.1 PrimaryIP:<nil>}] PodSubnet:{Family:0 Prefix:{IP:<nil> Mask:<nil>} Gateway:<nil> PrimaryIP:<nil>} DNS:{Suffix:kube-system.svc.cluster.local,svc.cluster.local,cluster.local Servers:[10.0.0.10] Options:[ndots:5]} Policies:[{Type:EndpointPolicy Data:[123 34 69 120 99 101 112 116 105 111 110 76 105 115 116 34 58 91 34 49 48 46 50 52 48 46 48 46 48 47 49 54 34 44 34 49 48 46 50 50 52 46 48 46 48 47 49 50 34 93 44 34 84 121 112 101 34 58 34 79 117 116 66 111 117 110 100 78 65 84 34 125]} {Type:EndpointPolicy Data:[123 34 65 99 116 105 111 110 34 58 34 66 108 111 99 107 34 44 34 68 105 114 101 99 116 105 111 110 34 58 34 79 117 116 34 44 34 80 114 105 111 114 105 116 121 34 58 50 48 48 44 34 80 114 111 116 111 99 111 108 115 34 58 34 54 34 44 34 82 101 109 111 116 101 65 100 100 114 101 115 115 101 115 34 58 34 49 54 56 46 54 51 46 49 50 57 46 49 54 47 51 50 34 44 34 82 101 109 111 116 101 80 111 114 116 115 34 58 34 56 48 34 44 34 82 117 108 101 84 121 112 101 34 58 34 83 119 105 116 99 104 34 44 34 84 121 112 101 34 58 34 65 67 76 34 125]} {Type:EndpointPolicy Data:[123 34 65 99 116 105 111 110 34 58 34 65 108 108 111 119 34 44 34 68 105 114 101 99 116 105 111 110 34 58 34 73 110 34 44 34 80 114 105 111 114 105 116 121 34 58 54 53 53 48 48 44 34 84 121 112 101 34 58 34 65 67 76 34 125]} {Type:EndpointPolicy Data:[123 34 65 99 116 105 111 110 34 58 34 65 108 108 111 119 34 44 34 68 105 114 101 99 116 105 111 110 34 58 34 79 117 116 34 44 34 80 114 105 111 114 105 116 121 34 58 54 53 53 48 48 44 34 84 121 112 101 34 58 34 65 67 76 34 125]}] BridgeName:azure0 EnableSnatOnHost:false NetNs:63258ae5-03f7-46ab-bf53-a577e4034f41 Options:map[NCPrimaryIPKey:fd11:1234::100] DisableHairpinOnHostInterface:false IPV6Mode: IPAMType:azure-cns ServiceCidrs:}
2023/01/17 16:32:01 [3256] [net] Creating network Id:azure MasterIfName:vEthernet (Ethernet 2) AdapterName: Mode:bridge Subnets:[{2 {10.240.0.0 ffff0000} 169.254.1.1 <nil>} {10 {fd11:1234:: ffffffffffffffffffffffffffff0000} 169.254.1.1 <nil>}] podsubnet:{0 {<nil> <nil>} <nil> <nil>} Enablesnatonhost:false.
2023/01/17 16:32:01 [3256] [net] Creating hcn network: &{Id: Name:azure Type:L2Bridge Policies:[] MacPool:{Ranges:[]} Dns:{Domain:kube-system.svc.cluster.local,svc.cluster.local,cluster.local Search:[] ServerList:[10.0.0.10] Options:[]} Ipams:[{Type:Static Subnets:[{IpAddressPrefix:10.240.0.0/16 Policies:[] Routes:[{NextHop:169.254.1.1 DestinationPrefix:0.0.0.0/0 Metric:0}]} {IpAddressPrefix:fd11:1234::/112 Policies:[] Routes:[{NextHop:169.254.1.1 DestinationPrefix:0.0.0.0/0 Metric:0}]}]}] Flags:0 Health:{Data:<nil> Extra:{Resources:[] SharedContainers:[] LayeredOn: SwitchGuid: UtilityVM: VirtualMachine:}} SchemaVersion:{Major:2 Minor:0}}
2023/01/17 16:32:01 [3256] [net] Failed to create network azure, err:Failed to create hcn network: azure due to error: hcnCreateNetwork failed in Win32: An adapter was not found. (0x803b0006) {"Success":false,"Error":"An adapter was not found. ","ErrorCode":2151350278}.
2023/01/17 16:32:01 [3256] [azure-vnet] createNetworkInternal: Failed to create network: Failed to create hcn network: azure due to error: hcnCreateNetwork failed in Win32: An adapter was not found. (0x803b0006) {"Success":false,"Error":"An adapter was not found. ","ErrorCode":2151350278}.
2023/01/17 16:32:01 [3256] Create network failed: %!w(*types.Error=&{100 createNetworkInternal: Failed to create network: Failed to create hcn network: azure due to error: hcnCreateNetwork failed in Win32: An adapter was not found. (0x803b0006) {"Success":false,"Error":"An adapter was not found. ","ErrorCode":2151350278} })
2023/01/17 16:32:01 [3256] [paul] ipamAddResult is {ipv4Result:0xc000206630 ipv6Result:0xc0002066e0 ncResponse:<nil> hostSubnetPrefix:{IP:[10 224 0 0] Mask:[255 255 0 0]}}
2023/01/17 16:32:01 [3256] [cni-net] ADD command completed for pod csi-azuredisk-node-win-gj7xl with IPs:[{Interface:<nil> Address:{IP:10.240.2.67 Mask:ffff0000} Gateway:169.254.1.1} {Interface:<nil> Address:{IP:fd11:1234::12e Mask:ffffffffffffffffffffffffffff0000} Gateway:169.254.1.1}] err:createNetworkInternal: Failed to create network: Failed to create hcn network: azure due to error: hcnCreateNetwork failed in Win32: An adapter was not found. (0x803b0006) {"Success":false,"Error":"An adapter was not found. ","ErrorCode":2151350278}.
2023/01/17 16:32:01 [3256] Failed to execute network plugin, err:createNetworkInternal: Failed to create network: Failed to create hcn network: azure due to error: hcnCreateNetwork failed in Win32: An adapter was not found. (0x803b0006) {"Success":false,"Error":"An adapter was not found. ","ErrorCode":2151350278}.
2023/01/17 16:32:01 [3256] [cni-net] Plugin stopped.